#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "util.h"
#include "sha2.h"

#define RUN_TEST(test, x, y) {if (is_equal(x,y) == TRUE) { printf(test); printf(" passed!\n"); } else { \
        printf(test); printf(" failed!\n"); printf("Expected: "); print_radix(y); printf("Got: "); print_radix(x);} }
#define RUN_TEST_STR(test, x, y) {if (strcmp(x,y) == 0) { printf(test); printf(" passed!\n"); } else { \
        printf(test); printf(" failed!\n"); printf("Expected: "); printf("%s\n", y); printf("Got: "); printf("%s\n", x);} }

uint16_t a[MAX_SIZE] = {0x8, 0x4867, 0x3767, 0x2d60, 0xa503, 0x7fe4, 0xa540, 0xc070, 0x67e7};
uint16_t b[MAX_SIZE] = {0x8, 0x78f9, 0x4952, 0x2293, 0xabbe, 0xb0c7, 0x2fb9, 0xe566, 0x4c4c};
/* e = gcd(a,b) */
uint16_t e[MAX_SIZE] = {0x1, 0x0001};
/* f = a^{-1} mod b */
uint16_t f[MAX_SIZE] = {0x8, 0x778c, 0x6c90, 0xa80c, 0xe431, 0x4674, 0x1b2c, 0x02a4, 0x3e99};
uint16_t m[MAX_SIZE] = {0x7, 0x78fa, 0xe4d2, 0x7165, 0x9ded, 0x9b72, 0x10f1, 0x1d56};
/* g = a / m  */
uint16_t g[MAX_SIZE] = {0x2, 0x8ab8, 0x0003};
/* h = a mod b */
uint16_t h[MAX_SIZE] = {0x8, 0xcf6e, 0xee14, 0xacc, 0xf945, 0xcf1c, 0x7586, 0xdb0a, 0x1b9a};
/* i = a * b */
uint16_t i[MAX_SIZE] = {0x10, 0xb42f, 0xdd63, 0xb06d, 0x0758, 0x5f64, 0x8fbe, 0x1be2, 0x03a2,
                        0x7400, 0x74d7, 0xb0f8, 0x81df, 0x9061, 0x5b5a, 0x030a, 0x1ef8};
/* j = a + b */
uint16_t j[MAX_SIZE] = {0x9, 0xc160, 0x80b9, 0x4ff3, 0x50c1, 0x30ac, 0xd4fa, 0xa5d6, 0xb434, 0x0000};
/* k = a - b */
uint16_t k[MAX_SIZE] = {0x8, 0xcf6e, 0xee14, 0x0acc, 0xf945, 0xcf1c, 0x7586, 0xdb0a, 0x1b9a};
uint16_t s = 0x2b73;
/* l = s * a */
uint16_t l[MAX_SIZE] = {0x9, 0xd345, 0x3c8e, 0x8b87, 0xa90c, 0xdb6d, 0x1174, 0x5e5c, 0x9a6e, 0x11a2};

uint16_t p[MAX_SIZE] = {0x8, 0xda84, 0xba01, 0xf583, 0xb33d, 0xd97a, 0x865f, 0x57b4, 0x16b8};
uint16_t q[MAX_SIZE] = {0x8, 0xcbfa, 0x5c6b, 0x8a92, 0xa8f9, 0xdf4c, 0x9055, 0xdef5, 0x213e};
uint16_t r[MAX_SIZE] = {0x8, 0xd639, 0xfe13, 0x6b1b, 0xb86c, 0xbd13, 0x1212, 0x7ca7, 0x43e3};
uint16_t R[MAX_SIZE] = {0x9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001};
uint16_t R_square[MAX_SIZE] = {0x11, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001};
uint16_t r_prime[MAX_SIZE] = {0x1, 0xC7F7};
uint16_t base[MAX_SIZE] = {0x2, 0x0000, 0x0001};
uint16_t R_square_mod_r[MAX_SIZE] = {0x8, 0xe589, 0x4bda, 0xdad7, 0x4355, 0x3470, 0x7f65, 0x704d, 0x36d3};
uint16_t R_mod_r[MAX_SIZE] = {0x8, 0x7d55, 0x5c4, 0xbeac, 0xd6ba, 0xc8c4, 0xc9c7, 0x8a0a, 0x3455};
uint16_t p_square[MAX_SIZE] = {0x10, 0x1410, 0x3f8d, 0xfca3, 0x2c34, 0xb016, 0xee8a, 0x6fb, 0x2026, 0xa194, 0x52cb, 0x533, 0x1a54, 0xd5cc, 0x38a5, 0x33d1, 0x204};
uint16_t p_mod_q[MAX_SIZE] = {0x8, 0xda84, 0xba01, 0xf583, 0xb33d, 0xd97a, 0x865f, 0x57b4, 0x16b8};
uint16_t pq_mod_r[MAX_SIZE] = {0x8, 0x1008, 0x40d6, 0xbd4b, 0xf112, 0x91b5, 0xd9a3, 0x9163, 0x3cc1};
uint16_t p_pow_q_mod_r[MAX_SIZE] = {0x8, 0x7380, 0x18ea, 0x7918, 0x9e48, 0x925d, 0x9a0c, 0xe689, 0xd75};

uint16_t u[MAX_SIZE] = {0x1, 383};
uint16_t v[MAX_SIZE] = {0x1, 271};

uint16_t neg_one[MAX_SIZE] = {0x8, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF};
uint16_t neg_two[MAX_SIZE] = {0x8, 0xFFFE, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF};
uint16_t max_neg[MAX_SIZE] = {0x8, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x8000};
uint16_t max_neg_plus[MAX_SIZE] = {0x8, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x8000};
uint16_t max_neg_twice[MAX_SIZE] = {0x9, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF};
uint16_t max_neg_min[MAX_SIZE] = {0x9, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x7FFF, 0xFFFF};
uint16_t max_pos[MAX_SIZE] = {0x8, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x7FFF};
uint16_t zero[MAX_SIZE] = {0x8, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000};
uint16_t one[MAX_SIZE] = {0x8, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000};
uint16_t two[MAX_SIZE] = {0x8, 0x0002, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000};
uint16_t two_pow_12[MAX_SIZE] = {0x1, 0x1000};
uint16_t test_array[MAX_SIZE] = {0x100, 0x830a, 0xcf59, 0x8404, 0xd99d, 0xc1b8, 0x04bc, 0x42b4, 0x4246, 0xbe70, 0x82f9, 0x8b0d, 0xa4c2, 0xd8fd, 0xa03f, 0x8abd, 0x8673, 0x498a, 0x38c0, 0x1e3c, 0x0b98, 0x7058, 0xc041, 0x6c98, 0x0dea, 0x4535, 0x63e7, 0xc351, 0x9e73, 0x0d29, 0x8225, 0x03f0, 0x6414, 0x9dc1, 0x5412, 0x6f3d, 0x4696, 0x713d, 0xd777, 0x2030, 0x095a, 0x0e99, 0x88ab, 0x239a, 0x8c13, 0x2b58, 0x57e3, 0x284d, 0x67e6, 0x262b, 0x6ff7, 0xd69d, 0x785d, 0x9e36, 0xc281, 0xbbed, 0x8608, 0x04f3, 0xfd9a, 0xb43a, 0xffb4, 0xc4bc, 0x1282, 0x075a, 0x1677, 0xf300, 0x961a, 0x653d, 0x6499, 0x0bca, 0xfe9f, 0x0d50, 0xcada, 0x53cd, 0x225d, 0x4219, 0x2798, 0xb0b8, 0x959e, 0xc1dd, 0x85c5, 0x6433, 0x6074, 0x7b85, 0xc3fe, 0x3ea7, 0x2212, 0x25ee, 0xd236, 0x3524, 0x2a5b, 0x2a5b, 0x2148, 0x7462, 0x02c4, 0xd203, 0x3fdf, 0x64d8, 0x6076, 0x7b0f, 0xe9b8, 0x02c7, 0x6c80, 0x0f0e, 0xc2dc, 0x6fa5, 0xea09, 0x7a9c, 0xbaec, 0x1df2, 0xfe1f, 0xd45d, 0xb66b, 0x9728, 0xffb4, 0xf98e, 0x6ffa, 0x201c, 0x8095, 0x3222, 0xbaf2, 0xdb2e, 0xe92c, 0xf94c, 0x29e9, 0x61cb, 0x60cf, 0x66cf, 0xd61e, 0xfafa, 0xcb83, 0x2ffe, 0x6dc6, 0x89d6, 0x0e9c, 0xaeed, 0x28e5, 0x5f5e, 0xd662, 0x234f, 0xfe30, 0xdb1c, 0x0300, 0x3667, 0xca5f, 0x469e, 0x3fec, 0x2e60, 0x8265, 0xaa13, 0x938c, 0x5f69, 0x455f, 0x304a, 0x67a9, 0xd7e5, 0xf034, 0x175b, 0x81e6, 0x25c2, 0x9593, 0x77cd, 0x949c, 0x06b6, 0x2c40, 0x24df, 0x2501, 0x985c, 0xa229, 0xf594, 0xb503, 0xe522, 0x8699, 0x8cc6, 0x8431, 0x940c, 0xc8fd, 0x689c, 0x9710, 0x1aea, 0xcce8, 0x9528, 0x2541, 0x6d94, 0x774f, 0x4787, 0x7192, 0xd7e9, 0xe8ba, 0x88bf, 0xc349, 0xbca6, 0x5f04, 0x4374, 0x6b95, 0xaf07, 0xbe6b, 0x7574, 0xe9b2, 0x1e1a, 0x3faf, 0xce2e, 0xf628, 0xbbc8, 0x21c2, 0x1fbb, 0x2808, 0x1e0d, 0x08e5, 0xe3b9, 0xf054, 0xc173, 0x4d50, 0xfd0e, 0xf9d5, 0x3429, 0x2167, 0x8fea, 0x6846, 0x12f9, 0x512e, 0x825d, 0x39d8, 0xb333, 0xa921, 0xadad, 0xa313, 0x76b9, 0x7120, 0x4aff, 0x892a, 0x431b, 0x2e51, 0x3f4f, 0x58bd, 0xa27e, 0x8f6f, 0xcf1b, 0x4c80, 0x7ef3, 0xa848, 0xfc8f, 0xd008, 0xb451, 0x3935, 0xfd85, 0x822e, 0xe061, 0x3ed9, 0x33bd, 0x1632, 0x7ec3, 0x8177, 0x790b, 0x1396, 0xafa9, 0x79da};
uint16_t test_array2[MAX_SIZE] = {0};
uint16_t test_array3[MAX_SIZE] = {0};

void test_addition() {
    mp_add(a, b, test_array);
    RUN_TEST("Addition test a + b", test_array, j);

    mp_add(neg_one, two, test_array);
    RUN_TEST("Addition test -1 + 2", test_array, one);

    mp_add(two, neg_one, test_array);
    RUN_TEST("Addition test 2 + -1", test_array, one);

    mp_add(zero, neg_one, test_array);
    RUN_TEST("Addition test 0 + -1", test_array, neg_one);

    mp_add(max_neg, neg_one, test_array);
    RUN_TEST("Addition test (max neg) + -1", test_array, max_neg_min);

    mp_add(neg_one, max_neg, test_array);
    RUN_TEST("Addition test -1 + (max neg)", test_array, max_neg_min);

    mp_add(max_neg_plus, neg_one, test_array);
    RUN_TEST("Addition test (max neg + 1) + -1", test_array, max_neg);

    mp_add(max_neg, max_neg, test_array);
    RUN_TEST("Addition test (max neg) + (max neg)", test_array, max_neg_twice);

    mp_add(neg_one, neg_one, test_array);
    RUN_TEST("Addition test -1 + -1", test_array, neg_two);

    mp_add(neg_one, one, test_array);
    RUN_TEST("Addition test -1 + 1", test_array, zero);
}

void test_subtraction() {
    mp_sub(zero, neg_one, test_array);
    RUN_TEST("Subtraction test 0 - -1", test_array, one);

    mp_sub(max_neg, neg_one, test_array);
    RUN_TEST("Subtraction test (max neg) - -1", test_array, max_neg_plus);

    mp_sub(max_neg, one, test_array);
    RUN_TEST("Subtraction test (max neg) - 1", test_array, max_neg_min);

    mp_sub(neg_one, max_neg, test_array);
    RUN_TEST("Subtraction test -1 - (max neg)", test_array, max_pos);

    mp_sub(max_neg_plus, one, test_array);
    RUN_TEST("Subtraction test (max neg + 1) - 1", test_array, max_neg);

    mp_sub(max_neg, max_neg, test_array);
    RUN_TEST("Subtraction test (max neg) - (max neg)", test_array, zero);

    mp_sub(neg_one, neg_one, test_array);
    RUN_TEST("Subtraction test -1 - -1", test_array, zero);

    mp_sub(neg_one, one, test_array);
    RUN_TEST("Subtraction test -1 - 1", test_array, neg_two);

    mp_sub(a, b, test_array);
    RUN_TEST("Subtraction test a - b", test_array, k);
}

void test_multiplication() {
    mp_mult(a, b, test_array);
    RUN_TEST("Multiplication test a * b", test_array, i);

    mp_mult_scalar(a, s, test_array);
    RUN_TEST("Multiplication test s * a", test_array, l);

    mp_square(p, test_array);
    RUN_TEST("p*p", test_array, p_square);
}

void test_division() {
    mp_div(a, m, test_array, test_array2);
    RUN_TEST("Division test a / m", test_array, g);

    mp_div(a, b, test_array, test_array2);
    RUN_TEST("Modulo test a mod b", test_array2, h);
}

void test_montgomery() {
    // Test montgomery exponentiation and multiplication
    mp_square(R, test_array);
    RUN_TEST("R*R", test_array, R_square);

    mp_div(R_square, r, test_array, test_array2);
    RUN_TEST("R*R mod r", test_array2, R_square_mod_r);

    mul_inv(r, base, test_array);
    twos_complement(test_array, test_array2);
    RUN_TEST("r prime", test_array2, r_prime);

    mont_mult(p, q, r, r_prime, test_array);
    mont_mult(R_square_mod_r, test_array, r, r_prime, test_array2);
    RUN_TEST("Montgomery multiplication pq mod r", test_array2, pq_mod_r);

    mont_exp(p, q, r, r_prime, R_mod_r, R, test_array);
    RUN_TEST("Montgomery exponentiation p^q mod r", test_array, p_pow_q_mod_r);
}

void test_dh() {
    uint16_t p4096[MAX_SIZE] = {0x100, 0xffff, 0xffff, 0xffff, 0xffff, 0x3199, 0x3406, 0x35c9, 0x4df4, 0xc08f, 0x90a6, 0xb7dc, 0x86ff, 0xddc1, 0x8d8f, 0xea98, 0x93b4, 0x5aa9, 0xd5b0, 0x9127, 0xd006, 0x481c, 0x2170, 0xdd76, 0xb81b, 0xd7af, 0xcee2, 0x2970, 0x1f61, 0xe7ed, 0x515b, 0xa186, 0x233b, 0xc3a2, 0xa090, 0x964f, 0x99b2, 0xc05d, 0x4e6b, 0x5947, 0x287c, 0xcaa6, 0x1fbe, 0xfc14, 0x2e8e, 0x8ef9, 0x4de, 0xc2db, 0xdbbb, 0x4ce8, 0x2ad4, 0xe9ca, 0x2583, 0xbda, 0xb615, 0x6834, 0x1a94, 0xe23c, 0x6af4, 0x2718, 0x99c3, 0x5b26, 0xbdba, 0x9a10, 0x8871, 0xe6d7, 0xa787, 0x3c12, 0x1a72, 0x801, 0xa921, 0xd120, 0x4b82, 0x108e, 0xe0fd, 0x5bfc, 0x43db, 0xab31, 0x74e5, 0x4fa0, 0x8e2, 0x46e2, 0xbad9, 0x88c0, 0x7709, 0x5d6c, 0x7a61, 0x1757, 0xbbe1, 0x200c, 0x177b, 0x2b18, 0x521f, 0x6a64, 0x3ec8, 0x273, 0xd876, 0x864, 0xd98a, 0xfa06, 0xf12f, 0xee6b, 0x1ad2, 0xd226, 0xcee3, 0x619d, 0x4a25, 0x94e0, 0x1e8c, 0x33d7, 0xdb09, 0xae8c, 0xabf5, 0xe4c7, 0xa6e1, 0xf85, 0xb397, 0xc7d, 0x5d06, 0x7157, 0x8aea, 0xef0a, 0x58db, 0x8504, 0xecfb, 0xba64, 0xdf1c, 0x21ab, 0xa855, 0x7a33, 0x450, 0x170d, 0xad33, 0xc42d, 0x8aaa, 0x8e5a, 0x1572, 0x510, 0x98fa, 0x2618, 0x15d2, 0x6ae5, 0xea95, 0x497c, 0x3995, 0x1718, 0x9558, 0xcbf6, 0xde2b, 0x52c9, 0x6f4c, 0x5df0, 0xb5c5, 0xa28f, 0xec07, 0x83a2, 0x9b27, 0x8603, 0x180e, 0x772c, 0xe39e, 0xce3b, 0x2e36, 0x5e46, 0x3290, 0x217c, 0xca18, 0x6c08, 0xf174, 0x9804, 0x4abc, 0x354e, 0x670c, 0x966d, 0x7096, 0x2907, 0x9ed5, 0x52bb, 0x2085, 0xf356, 0x1c62, 0xad96, 0xdca3, 0x5d23, 0x8365, 0xcf5f, 0xfd24, 0x3fa8, 0x6916, 0xd39a, 0x1c55, 0x4836, 0x98da, 0xbf05, 0xa163, 0x7cb8, 0xc200, 0x5b3d, 0xece4, 0x6651, 0x4928, 0x1fe6, 0x7c4b, 0x2411, 0xae9f, 0x9fa5, 0x5a89, 0x6bfb, 0xee38, 0xb7ed, 0xf406, 0x5cb6, 0xbff, 0xed6b, 0xa637, 0x42e9, 0xf44c, 0x7ec6, 0x625e, 0xb576, 0xe485, 0xc245, 0x6d51, 0x356d, 0x4fe1, 0x1437, 0xf25f, 0xa6d, 0x302b, 0x431b, 0xcd3a, 0x19b3, 0xef95, 0x4dd, 0x8e34, 0x879, 0x514a, 0x9b22, 0x3b13, 0xbea6, 0x20b, 0xcc74, 0x8a67, 0x4e08, 0x2902, 0x1cd1, 0x80dc, 0x628b, 0xc4c6, 0xc234, 0x2168, 0xdaa2, 0xc90f, 0xffff, 0xffff, 0xffff, 0xffff};
    uint16_t p4096_g[MAX_SIZE] = {0x1, 0x0002};
    uint16_t p4096_prime[MAX_SIZE] = {0x100, 0x1, 0x0, 0x0, 0x0, 0x319a, 0x3406, 0x35c9, 0x4df4, 0x1133, 0x7d7b, 0xe3fd, 0x565, 0x1c8, 0x75be, 0x4883, 0xe544, 0x1843, 0x8ae8, 0x3cab, 0xd084, 0x3027, 0xce44, 0xe0, 0x196c, 0x8f1a, 0xd7c2, 0x793c, 0x7832, 0x5044, 0xc49f, 0xf2fe, 0xcb41, 0x16a4, 0x40d0, 0xdf81, 0x17e4, 0x8506, 0x5ddb, 0x116c, 0x4dbf, 0xfd3d, 0x5fcf, 0x5c9c, 0x92be, 0x8b42, 0x215f, 0x9a9, 0x483e, 0x814e, 0xfdd8, 0xfa88, 0xc363, 0xb4f1, 0x87a5, 0x6ee1, 0xe494, 0x2a90, 0x9d2d, 0xcf2a, 0x54cf, 0x8f85, 0x22fc, 0xbf34, 0xd4e7, 0x1d7e, 0xb2bb, 0x2fe2, 0x3183, 0xf4a6, 0x265c, 0xdcee, 0x9946, 0x699d, 0xe291, 0x4071, 0xabc9, 0xfd2d, 0x8d53, 0xd765, 0xee24, 0x21c3, 0xf956, 0x90e2, 0xc666, 0x21, 0x4583, 0x47b7, 0xd095, 0x54da, 0x93a2, 0x122f, 0x7814, 0xdab3, 0x9a81, 0x3797, 0xe756, 0x401, 0x8eb7, 0x6d05, 0x48f5, 0xe653, 0x21d1, 0xe1e2, 0xdfc6, 0x7024, 0xcd75, 0xe5c8, 0xdb9d, 0xd394, 0x8754, 0x23, 0x5de8, 0xf692, 0x5b73, 0x827a, 0x3a75, 0x133b, 0x47e4, 0xed5a, 0xfd74, 0x2b99, 0xbaa9, 0x53bc, 0x936d, 0x12f5, 0xbf0b, 0x80ab, 0x4f23, 0xe7e5, 0xbdc8, 0xab3e, 0xdbfe, 0x267, 0xf783, 0x710, 0x1452, 0xa31a, 0xd12b, 0x2d6e, 0x25be, 0xb97a, 0xe07c, 0x2357, 0xb390, 0x5f23, 0x1e04, 0xb18b, 0x6511, 0xece4, 0xd5de, 0x541, 0x3900, 0x6b47, 0x28c3, 0xdfcf, 0x8afa, 0x40bb, 0x27cc, 0xcaaf, 0x8c1e, 0x2a04, 0x9337, 0xe76b, 0x7d34, 0xa561, 0x274a, 0x62cd, 0x91c1, 0x121c, 0x5eb, 0xab68, 0x9711, 0x74df, 0xfef3, 0xd19b, 0x999a, 0x8482, 0x906, 0xa808, 0x9a45, 0x8fb, 0x5e4b, 0xbb4, 0x7416, 0x259c, 0xc58b, 0xd25e, 0x719, 0x59e0, 0x16aa, 0x458e, 0x254f, 0x7062, 0xc0fa, 0xdd96, 0x2c13, 0xcffd, 0x3fe5, 0x8ee9, 0x3722, 0x90a2, 0xed68, 0x3, 0xf809, 0x3cd5, 0x5a9a, 0xf806, 0x92e9, 0x3d22, 0xd8de, 0x53b5, 0xbce3, 0x8d6e, 0xb6da, 0x8cfc, 0x40de, 0x798c, 0x3c33, 0xe554, 0x8fb6, 0xac0a, 0x7b18, 0xced0, 0x4b7a, 0xc4be, 0x7c84, 0x7ff7, 0xb8e5, 0xfad5, 0x2ea8, 0x59dc, 0xb1f3, 0xee89, 0x4a34, 0xfef7, 0x3001, 0xbeb6, 0x4b65, 0xf24d, 0xc991, 0xe103, 0xfaac, 0xadef, 0xb6c2, 0x9a15, 0x20e1, 0xbb03, 0xa158, 0xf860, 0xfe5e, 0xbdb6, 0x9837, 0x217f, 0x23ee, 0xfbcc, 0x17cd};
    uint16_t R[MAX_SIZE] = {0x101, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1};

    /* 256 bit random exponents for key generation */
    uint16_t x[MAX_SIZE] = {0x10, 0xb60a, 0x35ed, 0x06e1, 0x7dcd, 0xe225, 0x514e, 0x9ae2, 0x2f6b, 0x3f4f, 0x7a1a, 0xbe47, 0x8ba0, 0x7df3, 0x7681, 0xdc7c, 0xa2eb};
    uint16_t y[MAX_SIZE] = {0x10, 0xda5a, 0x5840, 0x8ac7, 0x3634, 0xa8f5, 0xd520, 0xaaac, 0xeaf7, 0xea1a, 0x4824, 0x2acd, 0x94e4, 0xd2a6, 0x9be8, 0xb5af, 0x152};

    uint16_t two_pow_x_expected[MAX_SIZE] = {0x100, 0xc8d3, 0x9efb, 0x0f56, 0xbbaf, 0x9adc, 0xb562, 0xb53c, 0x1651, 0x2364, 0xa8a4, 0xaefd, 0xbe48, 0x1dbb, 0xa31c, 0xfb6c, 0xbc21, 0x1ed6, 0x9330, 0xaaae, 0x7e0f, 0x81f0, 0xddf0, 0xf3ec, 0x5585, 0xf539, 0x5cc5, 0x85af, 0xa3ac, 0x7cd1, 0x6fb1, 0x0666, 0x197d, 0x8f33, 0x90ad, 0x235c, 0xe611, 0x83a1, 0x193f, 0x3d20, 0xd584, 0xa932, 0xf5aa, 0xe243, 0x4248, 0x1236, 0x1961, 0x9822, 0x8698, 0x0493, 0xee1d, 0x05f9, 0xf00c, 0x382a, 0x4da2, 0x9b96, 0x0184, 0x7069, 0xc5ea, 0xfb60, 0xe137, 0x9e64, 0x389f, 0x3df9, 0x4a53, 0x7820, 0xa546, 0x6242, 0xc937, 0x4703, 0x4133, 0x82eb, 0x6783, 0x8c7d, 0x7109, 0x5841, 0x6ca7, 0xa53e, 0xe8e4, 0x7f1b, 0xf729, 0xa39e, 0x40e1, 0x81aa, 0x82d0, 0x2c70, 0x2ba0, 0x749f, 0x7753, 0x0008, 0x86e5, 0xf918, 0x67b6, 0x43b9, 0x7e86, 0xf7b3, 0x1da4, 0x75b6, 0x172e, 0xdc47, 0xa4d2, 0xdac6, 0x239a, 0x7060, 0xfc90, 0xcbec, 0x4d6b, 0x308c, 0x411b, 0xc891, 0x0735, 0x9fda, 0x4a88, 0x38cc, 0x20fb, 0x8deb, 0x43a8, 0xa486, 0xeef4, 0xbc25, 0x8d18, 0x72bf, 0xbee6, 0x9951, 0xbc27, 0x7897, 0x3b9c, 0xad14, 0x28f6, 0x1bd5, 0x66e4, 0xf98e, 0x844a, 0x279b, 0x2567, 0x7a9a, 0x90dc, 0xd7a1, 0xaea4, 0x5322, 0xd37b, 0x9f7f, 0x7d15, 0xd35e, 0xa4c0, 0x8529, 0xd12c, 0x20c0, 0xdcaf, 0x180b, 0x5d8d, 0x460e, 0x523a, 0xaa63, 0xcddb, 0x0ff4, 0x865b, 0xfe1f, 0x235a, 0xde05, 0x0dae, 0xbfdf, 0x2950, 0x78da, 0x3994, 0x5ccf, 0x4511, 0x09b0, 0x11eb, 0x8ae4, 0xb248, 0xd80c, 0x566c, 0xb6a9, 0xe5f7, 0xe81c, 0x4d01, 0x7bba, 0xb0fe, 0x9410, 0x7119, 0x1288, 0x184b, 0x36db, 0x8763, 0x5a98, 0x10fe, 0x434d, 0x3054, 0x2ba7, 0x8556, 0xce77, 0xcec4, 0xb0ca, 0xfb2a, 0xb7d2, 0x67a6, 0x1037, 0xa29b, 0x795f, 0x679a, 0x30d2, 0x734d, 0xfd3c, 0xff43, 0x35bc, 0xdaed, 0xf2c5, 0x7697, 0xcf61, 0x0050, 0x18eb, 0xde3c, 0xb5c1, 0xd930, 0x7236, 0x19ce, 0xe522, 0x022c, 0x0af9, 0x392f, 0xb105, 0xd28f, 0x665d, 0x5987, 0xb84a, 0x673e, 0x6dd9, 0xea4a, 0x5015, 0xcea1, 0xfee5, 0x39da, 0x89eb, 0x4098, 0xb9eb, 0x92ca, 0x7b8b, 0x2fac, 0x7f8b, 0x896e, 0x1880, 0xb63f, 0x689e, 0x84a2, 0xb199, 0xe99d, 0xeec6, 0xe7b5, 0x89fb, 0x9daf, 0x65d5, 0xb458, 0x60f0, 0x2dcb, 0xd849, 0xae83};
    uint16_t two_pow_y_expected[MAX_SIZE] = {0x100, 0xe779, 0x690c, 0x01da, 0x11ed, 0xe8b7, 0x84bb, 0x277e, 0x2d6f, 0x3d2c, 0x71aa, 0x4f5f, 0x3f1b, 0x557b, 0x3cc1, 0x9188, 0x8385, 0xe081, 0x44f8, 0x7d22, 0xf30c, 0x6f60, 0x3b00, 0xb351, 0x88d5, 0x01a6, 0x27a0, 0x46a7, 0xa178, 0xffc3, 0x6528, 0xc32f, 0xb751, 0x38b5, 0x0f96, 0x8790, 0x2097, 0xadef, 0x4103, 0x8d9e, 0xca28, 0x16ae, 0x9ee6, 0xbddf, 0xa4b3, 0x277c, 0x0a3e, 0x92d7, 0xe91d, 0x46cf, 0x625c, 0x798e, 0x0688, 0xe36f, 0x44b8, 0x0ede, 0xf7a9, 0x8d02, 0x6751, 0xf792, 0x57a3, 0x4feb, 0x8327, 0x180a, 0x5ae9, 0x7dfe, 0xca9a, 0x45fe, 0xd2f1, 0x0db3, 0x6354, 0x9d58, 0x4248, 0x1d0b, 0x0ab1, 0x8202, 0x60d1, 0x02d1, 0x8c74, 0x3e9f, 0x749e, 0x586e, 0x888a, 0xf32b, 0x739d, 0xdd28, 0x1c7c, 0x915b, 0x81ce, 0xe921, 0x7a74, 0xaad6, 0x97ad, 0xf943, 0x2a87, 0x5b42, 0x09bc, 0x7d3c, 0x4680, 0x8cf6, 0x482a, 0x6bf6, 0x703f, 0xe065, 0xe9a7, 0x4421, 0xc8da, 0xfcd4, 0x9fe8, 0xb054, 0x3a1a, 0x053f, 0x45d1, 0xde7f, 0x0262, 0x541f, 0x5470, 0xa5d0, 0xdfab, 0xd527, 0xd3f7, 0xc42c, 0xc3cf, 0x85b0, 0x24da, 0x184f, 0x8990, 0x03ad, 0xb9d5, 0x0073, 0x8b5e, 0xdd48, 0x6a4e, 0x2ac4, 0x7502, 0x977f, 0xd6fd, 0xc030, 0x9787, 0x9fc7, 0xa1cf, 0x5585, 0xc6ce, 0xf9fb, 0xae00, 0x9a73, 0x3ce9, 0x8ec7, 0x5c68, 0x84ad, 0x7fcd, 0x8ddd, 0xf5dc, 0xf425, 0xb139, 0x6cab, 0xa738, 0x4d1a, 0x4ef8, 0x1aa0, 0x6385, 0x5209, 0x1d23, 0x8369, 0x54fd, 0x0b3e, 0x24fc, 0x4596, 0x1dca, 0x8f7f, 0xbf31, 0x1667, 0x99f9, 0x54c8, 0xacbf, 0xa6ff, 0x154c, 0xf0ab, 0x3d6c, 0x13a7, 0x47b2, 0x5f51, 0x9202, 0x3e1a, 0x2319, 0x01d8, 0xf01a, 0x08b7, 0x08d4, 0x959c, 0x2f98, 0xce70, 0x9b1e, 0x0bd3, 0xef7b, 0xfde0, 0xee19, 0x4444, 0x1235, 0x2b31, 0x2947, 0xb79f, 0xbbcc, 0xe842, 0x0619, 0x8f6e, 0x1ef7, 0xfd4a, 0xef16, 0x2a67, 0xcd42, 0xd6dd, 0x405b, 0x8c67, 0x5a44, 0x7012, 0x7c02, 0x0a68, 0x596a, 0x7163, 0xfda3, 0x48a4, 0xdb0b, 0x1a52, 0x0133, 0xd1ac, 0xef2f, 0x50fc, 0x2a33, 0xe5c9, 0xc236, 0x225c, 0x602f, 0xa433, 0xe1c3, 0x2793, 0xa603, 0xf9a8, 0xf7f9, 0x59ae, 0xdf26, 0xa868, 0x2278, 0x3306, 0x77c4, 0x636e, 0x39ed, 0x86d6, 0xa6a9, 0x5cb7, 0x51c9, 0x912f, 0x5b2b, 0x6fdd, 0x032f, 0xc306, 0xfe10};

    uint16_t two_pow_x[MAX_SIZE] = {0};
    uint16_t two_pow_y[MAX_SIZE] = {0};

    uint16_t ss_1[MAX_SIZE] = {0}; // shared secret
    uint16_t ss_2[MAX_SIZE] = {0};

    dh_mon_exp(p4096_g, x, p4096, p4096_prime, R, two_pow_x);
    RUN_TEST("a^x mod p test", two_pow_x, two_pow_x_expected);
    dh_mon_exp(p4096_g, y, p4096, p4096_prime, R, two_pow_y);
    RUN_TEST("a^y mod p test", two_pow_y, two_pow_y_expected);
    dh_mon_exp(two_pow_x, y, p4096, p4096_prime, R, ss_1);
    dh_mon_exp(two_pow_y, x, p4096, p4096_prime, R, ss_2);
    RUN_TEST("Diffie-Hellman shared secret test", ss_1, ss_2);
}

void test_sts() {
    /* Shared constants: modulus for Diffie Hellman (and its inverse) and the generator, 2 */
    uint16_t p4096[MAX_SIZE] = {0x100, 0xffff, 0xffff, 0xffff, 0xffff, 0xad07, 0x0003, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 0xc000, 0x2168, 0xdaa2, 0xc90f, 0xffff, 0xffff, 0xffff, 0xffff};
    uint16_t p4096_g[MAX_SIZE] = {0x1, 0x2};
    uint16_t p4096_prime[MAX_SIZE] = {0x100, 0x0001, 000000, 000000, 000000, 0xad08, 0x0003, 000000, 000000, 0xd040, 0x8323, 0x000d, 000000, 0xc200, 0xbd99, 0xab76, 0x0031, 0x1000, 0x1ae8, 0xd2a4, 0x94d0, 0x80b6, 0xda10, 0xcc07, 0x3ccb, 0x26b8, 0x79a3, 0x3ccd, 0x0357, 0x6d3b, 0x826c, 0x2e88, 0xc539, 0x551f, 0xa0e5, 0x3bac, 0x59d5, 0x70f1, 0x0110, 0x68d0, 0x9b03, 0xaebf, 0x77aa, 0xda69, 0x605f, 0xc2c8, 0x21ab, 0x802a, 0x58d4, 0xa083, 0x6858, 0xdf15, 0xe1be, 0xd19f, 0x08c7, 0xa939, 0xa7f8, 0x3dc9, 0xc3c7, 0xef0e, 0x45cb, 0x2cba, 0x7c58, 0xbe19, 0xcc18, 0x1860, 0xff2a, 0x9edb, 0x5389, 0x913d, 0xb4ec, 0x9fcd, 0x793b, 0xf5fb, 0x3942, 0x2077, 0xf444, 0x0c7b, 0xec45, 0x4134, 0x0d77, 0x04be, 0x310c, 0x9221, 0xc669, 0xbd6f, 0xb5ce, 0x9252, 0x4170, 0xc7d0, 0x9cc9, 0x98de, 0xd55e, 0xbf0c, 0x99c6, 0x0d46, 0x62df, 0x24b3, 0x5a78, 0xed74, 0xfac4, 0x8808, 0x72a8, 0x1c2e, 0xb2fc, 0x420d, 0x114d, 0x9ce9, 0x4b77, 0x6b56, 0x8636, 0x9be1, 0x0781, 0x8e19, 0x3a3f, 0xd962, 0xa608, 0x715f, 0x6f4e, 0xdb2d, 0xb754, 0x204b, 0xd130, 0xdb8e, 0xa44c, 0x5340, 0x7037, 0xd364, 0xa572, 0x35f3, 0xdebf, 0xcb9e, 0x3e9e, 0x46c4, 0xcf4a, 0x55bb, 0xa76d, 0x904f, 0x8071, 0x06d2, 0x1f8e, 0x4cea, 0x7301, 0xf8b5, 0x0b83, 0xfd4e, 0x5fc2, 0xbd67, 0x7552, 0xcac4, 0xbb2f, 0xe63a, 0xccca, 0x7964, 0x85d2, 0x13e4, 0x369d, 0x4fec, 0xd6cb, 0x9f0a, 0x1707, 0xc421, 0x0b21, 0xcfe0, 0xbbd7, 0xc2af, 0x76fb, 0x07eb, 0x25d9, 0x0af6, 0x227e, 0xc3b7, 0xf0e4, 0x20cf, 0x623b, 0x4782, 0x6a8e, 0x5ef8, 0x6975, 0x7f26, 0x514c, 0x1770, 0xb9c2, 0x2ad7, 0xb9c4, 0x9658, 0x3e38, 0x4c8c, 0xdf9c, 0xd59b, 0xf268, 0xe517, 0x8241, 0xa1d0, 0xec74, 0x2eca, 0x4928, 0x7d50, 0x1a70, 0x5d80, 0xfd41, 0x076a, 0x5024, 0xcd30, 0x2eba, 0x8041, 0xf064, 0x0016, 0x1a11, 0x9ace, 0xee93, 0x5258, 0x4ddc, 0x6c41, 0x04a4, 0x77bc, 0x4993, 0x6d3d, 0x870f, 0xdaf0, 0x5bb9, 0xb15d, 0xed05, 0xf7f7, 0x0794, 0xb515, 0x5521, 0x11fd, 0xd022, 0xf586, 0x8fab, 0xc1d7, 0xbd30, 0x3743, 0x92e0, 0x69d7, 0x220b, 0xb88a, 0xc225, 0xb59e, 0x0468, 0x8375, 0xb881, 0x3c9a, 0x06de, 0x3cdd, 0xd441, 0x9d09, 0x1bb6, 0x1927, 0x902b, 0xe424, 0xe601, 0x8a16, 0x01d3, 0x50f2, 0xb2ce};
    uint16_t R[MAX_SIZE] = {0x101, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 000000, 0x1};
    /* Prefix for DER encoding for SHA-256 (EMSA-PKCS1-v1_5) */
    uint8_t T_prefix[19] = { 0x30, 0x31, 0x30, 0x0d, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x01, 0x05, 0x00, 0x04, 0x20 };

    /* Constants party A - RSA public (n,e) and private (n,d) keys */
    uint16_t n_A[MAX_SIZE] = {0x100, 0xd3a3, 0xa40c, 0x3342, 0x9b37, 0x05d3, 0x4668, 0xc0ad, 0xa6e0, 0xac23, 0x3455, 0x6512, 0xf9bf, 0x2322, 0xd17a, 0x61df, 0x06b1, 0xeaab, 0x343e, 0xd317, 0x288c, 0xd117, 0x64c0, 0x8f45, 0xa23e, 0x4674, 0x2a6b, 0x5746, 0xabb4, 0x0a90, 0x95bd, 0xbcc4, 0xf958, 0x09c6, 0x8692, 0xe20a, 0xe45d, 0x7c1f, 0xb3a1, 0xdd79, 0x12c6, 0xb451, 0xe060, 0x23eb, 0x644e, 0xc57c, 0x344c, 0x28fe, 0x4626, 0xb5f3, 0xf86a, 0x07be, 0x926f, 0xdf6d, 0x8bbe, 0x80fa, 0x874f, 0xea72, 0x64d4, 0xb0d1, 0xbb1b, 0xc0bf, 0x84ff, 0xf6ee, 0xed3f, 0x11b7, 0x6f67, 0x8858, 0x4736, 0xf565, 0x68f7, 0x4dda, 0xf947, 0xab11, 0xc6d9, 0xc2ff, 0x4209, 0xf430, 0xfe1c, 0x08eb, 0xd5b3, 0x85ac, 0x09c6, 0x01d5, 0x8fc0, 0x1df2, 0xfa3c, 0x329f, 0xcff8, 0xea36, 0x4f0f, 0xc33e, 0x2e6d, 0x96d8, 0x4343, 0xae39, 0xc652, 0xa958, 0x3aa8, 0xbfc9, 0xbeed, 0xb565, 0x2c83, 0x6e4b, 0x620a, 0xd88a, 0x05c0, 0x3fad, 0xfe93, 0x3776, 0x9587, 0x9fe9, 0xa0d0, 0x1506, 0x7bf7, 0x20b5, 0x8e04, 0xe7e9, 0x84e2, 0xe4a5, 0x0e56, 0x83b1, 0xfde1, 0xa6d4, 0x34dd, 0x6657, 0xebd4, 0x2909, 0x35c7, 0xc759, 0x30cf, 0x4c59, 0x2bc1, 0x0d5a, 0x778c, 0x668d, 0xccb0, 0x39c1, 0x70bd, 0x1126, 0xa5c7, 0x8470, 0x795d, 0xb5a1, 0x70a7, 0x3562, 0x707f, 0xbf49, 0x1a6b, 0x431d, 0x6b86, 0xb84e, 0xcbb6, 0x991b, 0xe754, 0x65eb, 0x567e, 0xe53f, 0x2e4b, 0x1302, 0xcac7, 0xf15a, 0x31ff, 0x5e23, 0xd9a4, 0x04e4, 0x00ef, 0xae86, 0x7c5d, 0xf878, 0x577f, 0xcd55, 0x8bb0, 0xc40f, 0xc9f6, 0x1154, 0x3d4c, 0x38e5, 0x7376, 0xd04c, 0x552a, 0xa8c2, 0xa576, 0xe16f, 0xa726, 0x3698, 0x67af, 0x20d0, 0x9fbb, 0x06d4, 0x086f, 0xdbaa, 0x23a3, 0xd1cb, 0xfb78, 0xa1c8, 0x18e2, 0xf6b6, 0xd002, 0x5132, 0x9e6c, 0xb82c, 0x7f09, 0x6555, 0x030a, 0xfdab, 0x5932, 0x7163, 0xec33, 0xac4c, 0x3b7f, 0xd62a, 0x5175, 0x1ea0, 0x37d2, 0x3200, 0xbab5, 0x549d, 0x0086, 0x24e4, 0x87f4, 0xb116, 0xb48d, 0x98f6, 0xd009, 0xf1ed, 0xda73, 0xf7ed, 0xe49b, 0x6451, 0x980d, 0x05f7, 0xde6d, 0xb4ca, 0xc28e, 0x244c, 0xd591, 0xb78a, 0x43b2, 0xc325, 0x3903, 0x17ec, 0xd538, 0x5a9d, 0x6535, 0x54c7, 0xe012, 0xb10a, 0x9cad, 0x328c, 0x752a, 0x52fe, 0x41b7, 0x07b5, 0xaa75, 0xed62, 0xac7a};
    uint16_t n_A_prime[MAX_SIZE] = {0x100, 0x07f5, 0xa150, 0xa1eb, 0xb7e2, 0xa4c4, 0x8e76, 0x1d8e, 0xc241, 0x3ea5, 0x3373, 0xea0e, 0x58c1, 0xab99, 0x43f3, 0xc150, 0x951f, 0x28d8, 0xe06b, 0x0469, 0xebd0, 0xe2ed, 0xf0c4, 0xe793, 0xc0b6, 0x500c, 0x50f8, 0xc7c8, 0x3740, 0x33e4, 0xb95c, 0xee63, 0x2146, 0xc243, 0x0fb7, 0x0b32, 0x4e9d, 0xa17f, 0xca6b, 0x1066, 0x4419, 0x609e, 0x25bc, 0xcd9b, 0xa331, 0x4e62, 0x516e, 0x087a, 0x4cd8, 0x1fb9, 0x9d44, 0x2126, 0x2ee5, 0x3c60, 0x5017, 0x95f7, 0xd479, 0xfdf0, 0x287b, 0x46bb, 0x931b, 0x2525, 0x88b1, 0x2a79, 0xc17f, 0x4378, 0xfa9e, 0x0dcb, 0x055f, 0xfdb5, 0x0963, 0xc7fe, 0xcc67, 0x4ab6, 0x82b9, 0x3d76, 0x710d, 0x4f5f, 0x74b6, 0x3dbe, 0x9e2d, 0x87b8, 0x7274, 0xc452, 0x86b8, 0xdcf1, 0xdde7, 0xc112, 0xed53, 0x850d, 0xf9ef, 0x96f1, 0x11fa, 0x1d72, 0x625e, 0x5e51, 0xab35, 0x91e2, 0x8cb2, 0x998f, 0xcecb, 0x85fe, 0xc48c, 0x864e, 0x8a1f, 0xb386, 0xddb6, 0x84e3, 0xf623, 0x812b, 0xba56, 0xdfe2, 0x3605, 0x7b0b, 0x0cb3, 0xbc67, 0xf049, 0x0863, 0x3624, 0x2986, 0x82e6, 0xd99b, 0x3065, 0x3ce5, 0x0aa7, 0x7021, 0x6e77, 0x297c, 0xefaa, 0x96cb, 0x6a8c, 0x5323, 0x0e6c, 0x4249, 0xd342, 0x8eb4, 0xd1e0, 0xc304, 0x7fb9, 0x3601, 0xae15, 0xf08c, 0x1330, 0x5bbd, 0xb6d6, 0x3dbf, 0x37af, 0x22c9, 0x920b, 0xc726, 0xa97c, 0x29f7, 0xdcf7, 0x709a, 0x5bd2, 0xa2be, 0x345d, 0x4d99, 0x8754, 0xe5de, 0x33a0, 0x3667, 0xf25a, 0x5e0f, 0x0d34, 0xc5ce, 0xcf4f, 0xba73, 0x52dd, 0x60f9, 0xa9d6, 0xaa20, 0xca8b, 0xf20d, 0x48a6, 0x44e2, 0xcc91, 0x5e71, 0x0bc3, 0xb84d, 0xdcd1, 0x51de, 0xafed, 0x26d3, 0x82e4, 0x2bfa, 0x47a6, 0x9d98, 0xa766, 0x937c, 0x564a, 0x7268, 0xd048, 0x4d5b, 0x446e, 0xa864, 0xff07, 0xe3ea, 0x62f5, 0x0339, 0x3a28, 0x8e6d, 0xa746, 0xc9aa, 0x9c47, 0xe0f2, 0xc23f, 0x6186, 0xda38, 0x77eb, 0xf365, 0x733b, 0x1cd0, 0xaf7b, 0x3356, 0x9c04, 0x049e, 0x18e4, 0xc551, 0xb41b, 0xd41f, 0x3198, 0xce28, 0x2f83, 0xd295, 0x3d4d, 0xcb14, 0xbccc, 0x5f76, 0x62e7, 0x9e7b, 0x4ff6, 0x1455, 0xeb22, 0xe33b, 0x8f91, 0x799b, 0x63ca, 0x842d, 0x7bde, 0x951c, 0x7932, 0x6e4e, 0xb111, 0x879a, 0x13b4, 0x26b7, 0xcc11, 0x5ae7, 0x0615, 0xd085, 0xacdc, 0xbb1f, 0x5625, 0x88f5, 0xecc3, 0x23f6};
    uint16_t e_A[MAX_SIZE] = {0x1, 0x5};
    uint16_t d_A[MAX_SIZE] = {0x100, 0x4c85, 0x5e2f, 0xfb60, 0x7bd3, 0x5e3b, 0x7d1d, 0xee40, 0xd464, 0xea1c, 0xec4d, 0xa099, 0x3f4a, 0xe43d, 0xafa7, 0x7c63, 0x1f08, 0xcb18, 0x498c, 0x18ba, 0x296f, 0x751e, 0xba96, 0x237e, 0x5ab9, 0xdec8, 0x1046, 0x5b6c, 0x3020, 0xe446, 0xf1d9, 0x839c, 0x8cdd, 0x83dc, 0x07eb, 0x88ca, 0xf403, 0x8757, 0x998e, 0xf28a, 0x58be, 0xbdd6, 0xcba3, 0x3081, 0x34d8, 0x55af, 0xc5b9, 0x37ec, 0x2bc4, 0x93ad, 0xb396, 0x7b24, 0x6fbb, 0x761b, 0xb3be, 0x0402, 0xb6dd, 0x768b, 0x2390, 0xd0e5, 0xb9f8, 0x2b36, 0x460b, 0xd890, 0xb6bc, 0x7d32, 0xd260, 0x0dd9, 0xdc7a, 0xbbb7, 0x8f9b, 0xb747, 0x030e, 0xda16, 0x94de, 0x3a94, 0x556d, 0x8240, 0xc15a, 0x9735, 0xb0ec, 0x4748, 0x5339, 0x7b2a, 0x9aa4, 0xa62d, 0x5adb, 0xe50d, 0x8915, 0x4fdf, 0xe17a, 0x72c8, 0x2168, 0xfa3c, 0xbb78, 0x1383, 0xc631, 0xf647, 0x8048, 0xaf3c, 0xed90, 0x9207, 0x0aee, 0x7acc, 0x9361, 0xfe6d, 0x378f, 0xb813, 0xb05a, 0x96ab, 0x3b0b, 0xdedc, 0x9bcb, 0x4285, 0xd6da, 0xa05b, 0xf537, 0x40a1, 0x1b67, 0xf0b6, 0x9280, 0x7df0, 0x88f5, 0x19e7, 0x82a8, 0x408b, 0xd626, 0xf244, 0xd4d8, 0xf4aa, 0xd68f, 0xdc11, 0xa259, 0x02ab, 0x4b1c, 0xae1c, 0xc289, 0xa526, 0x7cf2, 0x69d4, 0xbac1, 0xe749, 0x1845, 0xbded, 0xe354, 0xa446, 0xe34c, 0x2641, 0x6baf, 0x409f, 0x1581, 0xbe76, 0xc257, 0xb838, 0xc7dd, 0x7ac8, 0x114c, 0xc773, 0x6fa8, 0x3700, 0x288e, 0xfd12, 0x09ff, 0x4607, 0x2b87, 0x9a94, 0xccfc, 0x561a, 0xe5ac, 0x64e4, 0x77e6, 0x8f77, 0x8256, 0x5a69, 0xf531, 0x9d10, 0x3f75, 0x3e94, 0xb0b1, 0xf675, 0x776e, 0x21c0, 0x877e, 0x6049, 0x54a1, 0x0aeb, 0x7b23, 0x6cf6, 0x5325, 0x9af7, 0xce7c, 0x2bee, 0x6d87, 0x29f5, 0xff18, 0xb9f4, 0x9e93, 0x3157, 0x299a, 0xdd0a, 0xb948, 0x24d5, 0xe635, 0xaddd, 0x009b, 0x65ef, 0x783d, 0x16ad, 0xc8d7, 0x2275, 0xd8b3, 0xc46e, 0x104a, 0x0620, 0x0b2a, 0x0a00, 0xbef1, 0x7752, 0x99b4, 0xd42d, 0x1b30, 0x569e, 0x241c, 0x84fe, 0x299b, 0x96c9, 0xf87d, 0x3195, 0x941f, 0x4743, 0x519c, 0xcdfe, 0xc615, 0x575b, 0x26e9, 0xa0dc, 0x2ab6, 0xf182, 0xda56, 0x8d6d, 0x71cd, 0x9e62, 0xf771, 0x7885, 0xadd7, 0x10f4, 0xc66a, 0x569b, 0x85bc, 0x7082, 0xb108, 0x76ff, 0xd9f1, 0x34bd, 0xeee4, 0xfc46, 0x227e};

    /* Constants party B - RSA public (n,e) and private (n,d) keys */
    uint16_t n_B[MAX_SIZE] = {0x100, 0x034b, 0x7ac0, 0x0618, 0x1e0e, 0x7cca, 0x9f37, 0x8349, 0x5b07, 0x4881, 0x9588, 0xa157, 0x59c8, 0xf884, 0x5c3c, 0x1491, 0x0e6f, 0xe324, 0x44fc, 0x1143, 0x44d2, 0xb02a, 0x31d6, 0xbde5, 0x8f80, 0xb3d5, 0x719f, 0x13ee, 0x8dd5, 0xc13e, 0x23e6, 0x9e67, 0xd6e2, 0x6e55, 0xf7a0, 0xde80, 0x9396, 0xd47b, 0x5664, 0x4c1f, 0xac36, 0x7c1f, 0x251c, 0x65ee, 0xb5c7, 0x8bb3, 0x52dc, 0xc644, 0x89a0, 0xe0fe, 0xec00, 0xb9c1, 0x5941, 0x726d, 0x3a66, 0x9549, 0x08cf, 0xd620, 0x22a4, 0xe9aa, 0xb8e9, 0x12dc, 0x13ef, 0x2e64, 0x9cb4, 0xd278, 0xdfa5, 0x2767, 0x6ddf, 0x4c92, 0x2624, 0xd290, 0x270f, 0xa236, 0x8720, 0x9e6e, 0xd7e6, 0x9059, 0x9707, 0x6c64, 0x1950, 0x99f9, 0x4aae, 0x9143, 0x1818, 0xbc9b, 0xd010, 0xf8df, 0x327a, 0x05a4, 0x88b8, 0x5cf3, 0xdedf, 0x5c36, 0xcc12, 0x4df7, 0xb68a, 0xc82d, 0x62f9, 0xaf04, 0x5bc0, 0x0286, 0xefc4, 0x055b, 0x5576, 0x943d, 0xf865, 0xd462, 0x2e6d, 0x9d99, 0xb4ae, 0x277f, 0xe637, 0xc7b9, 0xe477, 0x9e58, 0x5c9d, 0xb645, 0x9435, 0xa1d5, 0x2169, 0x9276, 0x2a2c, 0x71e1, 0x1987, 0xc8fd, 0x8b26, 0x1eb7, 0x7972, 0x976f, 0x6221, 0x416e, 0x6176, 0xe807, 0x1a9d, 0x80f3, 0xdbaa, 0xf2cd, 0x3390, 0x2ef7, 0xcdf1, 0xf9e4, 0x71c9, 0x9eeb, 0x1996, 0xdb46, 0x8cf8, 0xb04a, 0x74bb, 0x1498, 0x321c, 0xa6d6, 0xe225, 0xc365, 0x52cd, 0x2324, 0x1688, 0xfc04, 0x31ea, 0xe333, 0x9c60, 0x2458, 0x1ca5, 0x51ff, 0x7271, 0x7867, 0x1440, 0xdf06, 0xf961, 0xf0f8, 0x576c, 0xdfc1, 0x31cd, 0xf080, 0xa104, 0x60e7, 0x84df, 0xabed, 0xe870, 0xdee1, 0x831a, 0x2f73, 0xbbaa, 0x5a9c, 0x29ad, 0xa0ee, 0xe7a2, 0x5785, 0x59ed, 0x2ad1, 0x10f8, 0x1c58, 0x71ba, 0xaff8, 0x3a26, 0x61f5, 0x1439, 0x02fb, 0xd8fa, 0x32f7, 0xa85d, 0x52ee, 0x7447, 0xad2d, 0x0407, 0x61b7, 0x816b, 0xd4ed, 0x63bc, 0x21be, 0x80b8, 0xc0be, 0x136a, 0x2b26, 0x60b6, 0x768e, 0x0eff, 0x8599, 0x0221, 0x5202, 0xdee0, 0x5370, 0xba22, 0x8cf4, 0x1dde, 0x1835, 0x0d48, 0x9884, 0x712a, 0x7cba, 0xb2a5, 0xffba, 0xe791, 0xfb54, 0x4305, 0xef57, 0x02a1, 0xa395, 0xc93c, 0x3943, 0x3128, 0x1577, 0x3fd6, 0x1b2f, 0x1e76, 0xaa2d, 0xccf0, 0x19df, 0x201e, 0x2708, 0x7b2f, 0xf084, 0x07e4, 0x4a9b, 0xe8f1, 0x0ff1, 0xa601};
    uint16_t n_B_prime[MAX_SIZE] = {0x100, 0x119d, 0x7e52, 0x8762, 0x8c1d, 0xaf55, 0x6a5b, 0xcad8, 0x1a49, 0xa3db, 0x8583, 0x87d1, 0xb3cc, 0xa74e, 0xa8b4, 0xbbd4, 0xdedd, 0x3a40, 0xd4cf, 0x117c, 0x8686, 0x83ff, 0x0a7d, 0xdc5b, 0x8b22, 0xd1eb, 0x856c, 0xfc73, 0x44bc, 0xe02d, 0xf72f, 0x9208, 0x35f2, 0xdc75, 0xe4e1, 0x3083, 0x60bd, 0x7fb6, 0x3d37, 0xd11a, 0xa86a, 0x5266, 0x526c, 0x6e19, 0x9072, 0x6cf5, 0x253f, 0x399d, 0x55b6, 0x1566, 0x985b, 0x3aa6, 0x3834, 0x68e8, 0x95f1, 0x14dc, 0x09d2, 0xf600, 0xdf16, 0x52cc, 0x5924, 0x1333, 0xf66f, 0xc46f, 0xeb60, 0xb0c9, 0x3321, 0x9c4a, 0xf7e9, 0x3832, 0x7c45, 0x601b, 0x62c8, 0x4550, 0x0e1f, 0x50c7, 0x03f6, 0x808a, 0xc2f6, 0xef8f, 0x87d3, 0x9083, 0x378d, 0xd85a, 0xb29a, 0xdb45, 0x1330, 0x4ae3, 0xc299, 0x5096, 0xa5e6, 0xd904, 0x9c65, 0x67f8, 0xf092, 0xbc03, 0xe0d1, 0x8fc6, 0xca92, 0x72af, 0x0aad, 0x4517, 0x914f, 0x4107, 0xd133, 0x6bb2, 0x43a0, 0xa9e9, 0x5fb6, 0x6bb7, 0xf8f1, 0x370c, 0x48fd, 0xb4a6, 0x7f48, 0x313d, 0x9d0f, 0xfe68, 0x5883, 0xcd6a, 0x27f0, 0xfba1, 0x21d0, 0x1492, 0xf34a, 0x9b66, 0xa41d, 0xeaf6, 0xb72a, 0xd957, 0x369d, 0x7a8a, 0xde84, 0x1f56, 0xaf51, 0x1295, 0x23eb, 0x9742, 0x7268, 0x6da6, 0x5acb, 0x0344, 0xc680, 0xe8d7, 0x2d40, 0xd8d6, 0xac69, 0x2280, 0xf6ca, 0xe9ee, 0x98a4, 0x015d, 0x4c55, 0xa31c, 0x785b, 0x02b9, 0x14e2, 0xc18f, 0xa8c5, 0x86cb, 0x9838, 0x9c12, 0x8f54, 0x8199, 0x0777, 0xdb46, 0x347c, 0xc5f2, 0xec76, 0x1d1c, 0x94a3, 0x2ce4, 0x705d, 0xf4a4, 0x729b, 0xc7dd, 0xf181, 0x3646, 0x9eaf, 0x1a6f, 0x10ca, 0x47e6, 0xc390, 0xd388, 0xca30, 0x1385, 0x9d7b, 0xcbe8, 0x7e75, 0xdf7b, 0x3040, 0x5926, 0xfe3f, 0xdb02, 0x73fb, 0xa3fa, 0x8d3e, 0x8fa8, 0x2b81, 0x5fb7, 0xf5ca, 0x1cec, 0xe944, 0x6105, 0x6f4a, 0xce18, 0x64ca, 0x8655, 0x62d5, 0x7e5d, 0xdc2d, 0x820a, 0x391e, 0x51f7, 0xccbc, 0x1775, 0x3770, 0xfbd2, 0xbbc7, 0x4078, 0x1561, 0x262e, 0x1267, 0x2fdc, 0x09e7, 0x931e, 0x44d1, 0x6816, 0xba0e, 0x8aa2, 0xbdd1, 0x6fc4, 0xd4f3, 0x4d69, 0x485e, 0x1014, 0x3ac5, 0x3a7d, 0x8488, 0x82f0, 0x9ead, 0x334d, 0xd267, 0x5597, 0x86d2, 0x8425, 0x12bd, 0x4f39, 0xf775, 0x787c, 0x61a3, 0x0016, 0xd4af, 0x48f7, 0xee65, 0x6604, 0xd876};
    uint16_t e_B[MAX_SIZE] = {0x1, 0x3};
    uint16_t d_B[MAX_SIZE] = {0x100, 0xceab, 0x07ff, 0xaa7c, 0xcbd4, 0x0b65, 0x2409, 0x2234, 0x3eb0, 0xda42, 0x3d81, 0x93de, 0x3cea, 0x1819, 0xf594, 0xc7cc, 0xe577, 0x4228, 0xd1ab, 0xf04f, 0x4e56, 0x5187, 0x23a5, 0x90b8, 0x9e48, 0x0de2, 0x3313, 0xbfa7, 0x7ef5, 0xa1c7, 0xca47, 0x7791, 0xc31e, 0xec3b, 0x17e7, 0xe0f0, 0x8ecc, 0xeb96, 0xe47b, 0x6474, 0xb26e, 0x7f4c, 0x455e, 0x5459, 0x4964, 0x1fdf, 0xb8ec, 0xfb32, 0x71f7, 0x07b5, 0xc415, 0x0528, 0x0eae, 0xd1f2, 0x18b5, 0xdb72, 0xf843, 0xe5e6, 0x369a, 0xb101, 0x98b9, 0xf931, 0x7436, 0x87cf, 0x9558, 0x6c8b, 0x7b12, 0x1d8d, 0xe26f, 0x7864, 0x558c, 0xc5f6, 0xab27, 0x2b87, 0x6932, 0x1e30, 0x6b6f, 0x32b5, 0x5b22, 0x1c72, 0xff16, 0x95b0, 0x2b53, 0x0b05, 0x12fb, 0xc4c5, 0x7cd4, 0xb128, 0x593c, 0x9560, 0x22b0, 0x4afb, 0xe486, 0xbbd5, 0x739b, 0x6754, 0xb614, 0x9ec4, 0x543d, 0xa588, 0x5bdd, 0xf7a2, 0xb02d, 0x93e8, 0x5e0b, 0x120e, 0x400b, 0x11d6, 0xe107, 0x718a, 0x815c, 0x1086, 0xeef7, 0x93bf, 0xa921, 0xa669, 0xbcd5, 0x057b, 0xd156, 0x0d4e, 0xca9c, 0xdf23, 0x5557, 0xbf8d, 0x21f8, 0x7691, 0x732b, 0xdded, 0xd874, 0xba47, 0x416b, 0x80f4, 0x40f9, 0x455a, 0xbc69, 0xab4c, 0x9271, 0xa1de, 0x2260, 0xc9fa, 0xdea0, 0xfbed, 0x4bdb, 0x69f2, 0x6664, 0x3cd9, 0x5dfb, 0xcadc, 0xa327, 0xb865, 0xcc12, 0xc48e, 0x96c3, 0x2cee, 0x8c89, 0x176d, 0xb9b0, 0xa802, 0x769c, 0x9777, 0x6840, 0x6d90, 0xbdc3, 0xe154, 0xa1a0, 0xfaef, 0xb82a, 0x94ae, 0xfb96, 0xa0a5, 0x3a48, 0x3fd6, 0x7689, 0xa055, 0x6b58, 0x409a, 0xadea, 0xc7f3, 0x9af5, 0x9496, 0xacbc, 0x74f7, 0xd271, 0x91bd, 0xc673, 0xc09e, 0xefc1, 0xe503, 0x9148, 0x1c8b, 0x0b50, 0xbd90, 0xa126, 0xcaa5, 0x7c19, 0x96a3, 0x0d7b, 0x5752, 0x3b51, 0xcca5, 0x1ae8, 0x8c9f, 0xf82f, 0xc8c8, 0x02af, 0x967a, 0x5647, 0x389e, 0x97d3, 0xc129, 0x007a, 0x807f, 0xb79c, 0xc76e, 0x95ce, 0x4f09, 0xb4aa, 0x5910, 0xac16, 0xe156, 0xe9ea, 0x8cf5, 0x26c1, 0x08a3, 0x693f, 0x1023, 0x5e30, 0x65ad, 0xf61c, 0x5326, 0xcc6e, 0xffd1, 0x450b, 0xfce3, 0x8203, 0x9f8f, 0x5716, 0xc263, 0xdb7d, 0xd0d7, 0x761a, 0x0e4f, 0x7fe4, 0x121f, 0x69a4, 0x7173, 0x88a0, 0xbbea, 0x6abe, 0x1a05, 0xfcca, 0x4b02, 0x0543, 0x8712, 0x9b4b, 0x5ff6, 0x6eab};

    /* 256 bit random exponents for key generation */
    uint16_t x[MAX_SIZE] = {0x10, 0xe699, 0x918f, 0x5e57, 0xbe1f, 0xfb09, 0x7c97, 0xa07e, 0xb3e9, 0x23fb, 0xc602, 0xbf1c, 0xe4f1, 0x30a9, 0x9e55, 0xefe1, 0xb1ec};
    uint16_t y[MAX_SIZE] = {0x10, 0x49de, 0x66fb, 0x6d6b, 0xa39b, 0x66a3, 0x70d3, 0x8a07, 0x9dd1, 0xadfa, 0xb342, 0x9dcd, 0x0bf8, 0x5397, 0x839e, 0x5b21, 0xdea2};

    uint16_t two_pow_x_expected[MAX_SIZE] = {0x100, 0x5161, 0xfc1d, 0xafff, 0xfe89, 0xb7d2, 0xbb1b, 0x07a7, 0xcc05, 0x5e11, 0xd079, 0x64f8, 0xaa3a, 0x4782, 0x0626, 0x376d, 0x2b4c, 0xa593, 0x7d1b, 0x8acd, 0xd561, 0x0675, 0xdf4b, 0x2fbe, 0x8094, 0xf839, 0xd33f, 0x4bf5, 0xab30, 0x756c, 0xd5e4, 0x6c20, 0x78e9, 0xb55f, 0x5a3a, 0x0e9d, 0xe19f, 0xf755, 0x4a68, 0x0828, 0x0475, 0x2cc0, 0x81e9, 0x1a4c, 0xcb95, 0xeaf3, 0x40ad, 0xc119, 0x4407, 0xf81f, 0x66c5, 0x72f2, 0xc34f, 0x42e4, 0x6df5, 0x6951, 0x45c9, 0x5fd6, 0x50cd, 0x8c75, 0x649e, 0x9e11, 0x3631, 0x3636, 0x7e81, 0x7cae, 0x0c08, 0xfac9, 0x38ca, 0x4cc6, 0xfc87, 0x7d80, 0x7da0, 0xa458, 0x82c5, 0xf088, 0x898b, 0x0acf, 0x9945, 0xa4cc, 0xc16d, 0xc88d, 0x5e97, 0x6109, 0x0d69, 0x7ba3, 0x5556, 0xb3f8, 0xe10c, 0x8bf6, 0xeb1d, 0x04a4, 0x0f78, 0xa0d2, 0xa924, 0xf6e6, 0x945b, 0x8d3e, 0x7541, 0x7910, 0xb35a, 0xa43a, 0x4763, 0x98de, 0x3681, 0x0411, 0xbb8b, 0xae9b, 0x686e, 0xf7db, 0x923b, 0xab40, 0xccc2, 0x2c15, 0x4a5f, 0x7320, 0x8cef, 0x769f, 0x22a5, 0x631c, 0xba54, 0x246a, 0xb6af, 0xd52f, 0x64ac, 0x2762, 0xec68, 0xb49f, 0x7ba9, 0x75c0, 0xcf21, 0x9f61, 0xc76a, 0xce21, 0xbf75, 0xf230, 0x9eab, 0x8b23, 0xab94, 0xae7a, 0xb1d2, 0x7516, 0x9102, 0x74d7, 0x703b, 0xd918, 0x5102, 0x482d, 0x76e7, 0x639d, 0xfd4d, 0x5bcf, 0x82bc, 0x221a, 0xffd6, 0xcb39, 0x4017, 0x90ce, 0x1b64, 0x2022, 0xa2e4, 0xa4e2, 0xaaf1, 0xe51c, 0xf99b, 0xa8ab, 0x6cd6, 0x9497, 0xe34f, 0xd1f8, 0x10d8, 0x7fb0, 0xeaa8, 0x7cda, 0xbd01, 0xbfce, 0x8cc1, 0x768a, 0x3497, 0x239a, 0x9f56, 0xbbac, 0x9924, 0xa396, 0x7b9a, 0x99d3, 0x4755, 0x5526, 0x1283, 0x73b3, 0xe5c5, 0x4a60, 0xfba4, 0x5e0f, 0x6e1c, 0x76db, 0x03d0, 0x3756, 0x397b, 0xb033, 0x2a81, 0x7df9, 0x2587, 0x542f, 0x5ce3, 0x219a, 0xd2eb, 0x5528, 0xf5e5, 0xaace, 0x42cf, 0xc9d4, 0xdcfc, 0x6b46, 0x60e4, 0xa9dd, 0xa2e3, 0xda9b, 0x9e39, 0x7a4a, 0xda41, 0xf433, 0xf629, 0x9f40, 0xd47c, 0xbab3, 0x7179, 0x199d, 0xd5ee, 0x56fa, 0x6ec8, 0xfd28, 0x185f, 0x62d2, 0x2521, 0x0ecf, 0x9335, 0x78ab, 0x611e, 0x2014, 0x80f2, 0xd7dc, 0x2b62, 0xe289, 0x28df, 0xac9d, 0x18db, 0xeb1b, 0xce33, 0x5d10, 0x84c6, 0x5c26, 0xdf2b, 0x1128, 0x8a15, 0x3e6c, 0x2a0b};
    uint16_t two_pow_y_expected[MAX_SIZE] = {0x100, 0x82cc, 0x4efe, 0xccb1, 0xf5a6, 0xbbd7, 0x2941, 0xeb98, 0xe967, 0x0115, 0x1577, 0x9aab, 0x09cf, 0x9893, 0x76ef, 0xd465, 0xa962, 0x098a, 0x88c5, 0x857a, 0xca70, 0xcf33, 0xbb7d, 0xcc19, 0xfb42, 0xeebe, 0xb6da, 0x7cc2, 0x66a2, 0xd119, 0x35d9, 0x8ae1, 0x318b, 0xcfa5, 0xe221, 0xb873, 0xe8c2, 0x8503, 0x7d1f, 0x771f, 0xa015, 0x3f33, 0xb523, 0xfef6, 0xf211, 0x4f67, 0x907f, 0x2d24, 0xe579, 0x3a0a, 0x82bf, 0x22f5, 0x8c2b, 0xf84b, 0x9ece, 0x87ac, 0x0e2a, 0xc245, 0xf4d0, 0x755a, 0x25a5, 0x8bbe, 0x3527, 0xd587, 0x09b0, 0xebac, 0x9988, 0xf5c8, 0x330d, 0x6157, 0x3873, 0x85fb, 0x4c4e, 0x003f, 0xc980, 0x0a09, 0x1f7e, 0x0a95, 0xe7d2, 0x2682, 0x9806, 0x44e6, 0x52e3, 0x45b8, 0x780c, 0xfe31, 0xffb0, 0xc0f2, 0x72fd, 0x51bc, 0xe6ad, 0x60d8, 0x4218, 0xf344, 0x6ba5, 0x2d9d, 0xc2eb, 0xbfe0, 0x685d, 0x2dff, 0x3ce0, 0xc69f, 0xf26f, 0xff22, 0x6290, 0x30d3, 0x85e9, 0x411e, 0x154f, 0xdd10, 0x63a5, 0x6bae, 0x1025, 0xa5ef, 0x2428, 0xa883, 0xb07f, 0x05aa, 0x4783, 0x1fa9, 0x594e, 0x21c7, 0xf90a, 0xd308, 0x06f1, 0xa473, 0x10ca, 0x574d, 0x1a57, 0xb750, 0x48cb, 0x262f, 0xb585, 0x2665, 0x3b75, 0xe2ec, 0xf7ea, 0x91b6, 0xbe70, 0x5574, 0x43df, 0x03ec, 0x04c6, 0x03ff, 0x7f13, 0xb71c, 0xeeff, 0x2760, 0xf475, 0xef28, 0xb625, 0xbde8, 0x98ef, 0xb6b0, 0xe9a1, 0x7aac, 0x1fff, 0x7588, 0x18ad, 0xe2ca, 0x5528, 0xc66a, 0x2196, 0x7a49, 0xa956, 0xcac4, 0x3898, 0xace6, 0x74d2, 0x2600, 0x8a94, 0x57d1, 0xf9a7, 0x53c2, 0x560e, 0xd69c, 0xfaa2, 0x9e43, 0x3ffe, 0x86a4, 0x33a3, 0x6e1a, 0x09bc, 0x3fe9, 0xc310, 0x6f37, 0x28a7, 0x1907, 0xd75d, 0x6324, 0xca55, 0xbc03, 0xf4d8, 0xd146, 0x42dd, 0xba69, 0xb81d, 0xa0a1, 0xc940, 0x079b, 0x6efb, 0x0232, 0xfbbe, 0x2c33, 0x4468, 0xeea1, 0xc9f8, 0x5490, 0x983a, 0x3a07, 0x9db7, 0x1593, 0xd9ea, 0xfa35, 0x97b9, 0xc88b, 0x2b01, 0x6ce8, 0xa13f, 0x7f5d, 0x2c31, 0x0433, 0x4bc0, 0xedfe, 0xfb20, 0xe37f, 0x4052, 0xee2e, 0x3494, 0x8e25, 0xaf2c, 0x7db6, 0x18f2, 0x115d, 0x6585, 0x7721, 0xb557, 0x020c, 0xfcd0, 0x5474, 0x4d28, 0x6469, 0x8815, 0xef96, 0x43ef, 0xf29e, 0xe11f, 0xee29, 0x7c03, 0x00e5, 0x99e1, 0xae44, 0xb887, 0xa42e, 0x611e, 0x2402, 0x74a7};
    unsigned char key_expected[65] = "818f90e81dff44894d83b133f81d72e797432dbe4d5ac0d48e98454cc3c255ba";

    /* Buffers */
    uint16_t two_pow_x[MAX_SIZE] = {0};
    uint16_t two_pow_y[MAX_SIZE] = {0};
    uint16_t ss_A[MAX_SIZE] = {0};
    uint16_t ss_B[MAX_SIZE] = {0};
    uint16_t sig_A[MAX_SIZE] = { 0 };
    uint16_t sig_B[MAX_SIZE] = { 0 };
    unsigned char key_A[SHA256_DIGEST_STRING_LENGTH] = { 0 };
    unsigned char key_B[SHA256_DIGEST_STRING_LENGTH] = { 0 };
    uint8_t hash_A[SHA256_DIGEST_LENGTH] = { 0 };
    uint8_t hash_B[SHA256_DIGEST_LENGTH] = { 0 };
    uint8_t EM_A[128] = {0};
    uint8_t EM_B[128] = {0};
    uint16_t msg_A[MAX_SIZE] = {0};
    uint16_t msg_B[MAX_SIZE] = {0};
    uint16_t verif_A[MAX_SIZE] = {0};
    uint16_t verif_B[MAX_SIZE] = {0};

    SHA256_CTX ctx;
    int i;
    uint8_t* buf;

    /* STEP a). A send B message 1 (a^x mod p) */
    dh_mon_exp(p4096_g, x, p4096, p4096_prime, R, two_pow_x);
    RUN_TEST("a^x mod p test", two_pow_x, two_pow_x_expected);

    /* STEP b). Compute shared key. Sign concatenation of exponentials.
     * Send B message 2. (a^y mod p, Ek(Sb(a^y, a^x)) */
    dh_mon_exp(p4096_g, y, p4096, p4096_prime, R, two_pow_y);
    RUN_TEST("a^y mod p test", two_pow_y, two_pow_y_expected);
    
    dh_mon_exp(two_pow_x, y, p4096, p4096_prime, R, ss_B);
    buf = (uint8_t*)&ss_B[1];
    SHA256_Init(&ctx);
    SHA256_Update(&ctx, buf, 512);
    SHA256_End(&ctx, key_B);
    RUN_TEST_STR("Diffie-Hellman key test (B)", (const char*)key_B, (const char*)key_expected);

    SHA256_Init(&ctx);
    SHA256_Update(&ctx, (const uint8_t*)(&two_pow_y[1]), (size_t)two_pow_y[0]*2);
    SHA256_Update(&ctx, (const uint8_t*)(&two_pow_x[1]), (size_t)two_pow_x[0]*2);
    SHA256_Final(hash_B, &ctx);

    EM_B[1] = 1;
    for (i = 0; i < 74; i++) // remove magic number
        EM_B[2 + i] = 0xFF;

    for (i = 0; i < 19; i++) // remove magicnumber (tlen)
        EM_B[77 + i] = T_prefix[i];

    for (i = 0; i < 32; i++)
        EM_B[96 + i] = hash_B[i];

    msg_B[0] = 64;
    for (i = 0; i < 64; i++) {
        msg_B[i + 1] = EM_B[127 - 2 * i];
        msg_B[i + 1] |= (EM_B[126 - 2 * i] << 8);
    }
    dh_mon_exp(msg_B, d_B, n_B, n_B_prime, R, sig_B);
    /* encrypt sig_B */

    /* STEP c). A compute shared key. Decrypt encrypted data.
     * Verify signature. Send B encrypted signature. */
    dh_mon_exp(two_pow_y, x, p4096, p4096_prime, R, ss_A);
    buf = (uint8_t*)&ss_A[1];
    SHA256_Init(&ctx);
    SHA256_Update(&ctx, buf, 512);
    SHA256_End(&ctx, key_A);
    RUN_TEST_STR("Diffie-Hellman key test (A)", (const char*)key_A, (const char*)key_expected);

    // RSA verification
    dh_mon_exp(sig_B, e_B, n_B, n_B_prime, R, verif_A);
    RUN_TEST("Signature verification test (A verify B's signature)", verif_A, msg_B);

    SHA256_Init(&ctx);
    SHA256_Update(&ctx, (const uint8_t*)(&two_pow_x[1]), (size_t)two_pow_x[0]*2);
    SHA256_Update(&ctx, (const uint8_t*)(&two_pow_y[1]), (size_t)two_pow_y[0]*2);
    SHA256_Final(hash_A, &ctx);

    EM_A[1] = 1;
    for (i = 0; i < 74; i++) // remove magic number
        EM_A[2 + i] = 0xFF;

    for (i = 0; i < 19; i++) // remove magicnumber (tlen)
        EM_A[77 + i] = T_prefix[i];

    for (i = 0; i < 32; i++)
        EM_A[96 + i] = hash_A[i];

    msg_A[0] = 64;
    for (i = 0; i < 64; i++) {
        msg_A[i + 1] = EM_A[127 - 2 * i];
        msg_A[i + 1] |= (EM_A[126 - 2 * i] << 8);
    }
    dh_mon_exp(msg_A, d_A, n_A, n_A_prime, R, sig_A);

    /* STEP d). B decrypt encrypted data and verify signature */
    dh_mon_exp(sig_A, e_A, n_A, n_A_prime, R, verif_B);
    RUN_TEST("Signature verification test (B verify A's signature)", verif_B, msg_A);
}

int main(void) {
    /* bug with some x & y , still needs to be fixed... */
    test_dh();
    /* Full test of Station to Station protocol */
    test_sts();

    /*test_addition();
    test_subtraction();
    test_multiplication();
    test_division();

    binary_extended_gcd(b, a, test_array, test_array2, test_array3);
    RUN_TEST("GCD test: gcd(a,b)", test_array3, e);

    mul_inv(a, b, test_array);
    RUN_TEST("Modular inverse a^{-1} mod b", test_array, f);

    mp_div(R, q, test_array2, test_array3);
    barret_reduction(p, q, test_array2, test_array);
    RUN_TEST("p mod q (barret reduction)", test_array, p_mod_q);

    test_montgomery();*/
    return 0;
}